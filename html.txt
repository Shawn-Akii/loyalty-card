<!DOCTYPE html>
<html lang=\"zh-Hant\">
<head>
  <meta charset=\"UTF-8\" />
  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />
  <title>集點卡</title>
  <style>
    /* RWD 格子與基礎樣式 */
    :root{ --grid-size:clamp(60px,10vw,90px); --gap:clamp(8px,2vw,16px);}
    body{font-family:sans-serif; margin:0; padding:2rem; max-width:600px;}
    #lookup{display:flex; gap:.5rem; margin-bottom:1rem;}
    #lookup input{flex:1; padding:.6rem;}
    #lookup button{padding:.6rem 1rem;}
    #card{display:grid; grid-template-columns:repeat(4,var(--grid-size)); gap:var(--gap); margin-bottom:1rem;}
    .stamp{border:2px solid #444; border-radius:.3rem; display:grid; place-items:center; cursor:pointer;}
    .used{background:#e52521; color:#fff;}
    #info{text-align:center;}
    @media(max-width:420px){#card{grid-template-columns:repeat(3,var(--grid-size));}}
  </style>
</head>
<body>
  <h1>集點卡</h1>
  <div id=\"lookup\">
    <input id=\"phone\" type=\"tel\" placeholder=\"輸入手機號碼…\" />
    <button id=\"searchBtn\">搜尋</button>
  </div>
  <div id=\"card\" hidden></div>
  <div id=\"info\" hidden>
    <p id=\"remaining\"></p>
    <p id=\"service\"></p>
  </div>
<script>
  const API = 'YOUR_WEB_APP_URL_HERE';
  const cardEl = document.getElementById('card');
  const remainingEl = document.getElementById('remaining');
  const serviceEl = document.getElementById('service');
  let used = 0;

  document.getElementById('searchBtn').addEventListener('click', fetchData);
  document.getElementById('phone').addEventListener('keydown', e => {if(e.key==='Enter') fetchData();});

  async function fetchData(){
    const phone = document.getElementById('phone').value.trim();
    if(!phone){ alert('請輸入手機號碼'); return; }
    const res = await fetch(`${API}?phone=${encodeURIComponent(phone)}`);
    const data = await res.json();
    if(data.error){ alert('查無資料'); return; }
    used = +data.used_points || 0;
    buildCard();
    updateInfo(data.service);
  }

  function buildCard(){
    cardEl.innerHTML='';
    for(let i=1; i<=12; i++){
      const div = document.createElement('div');
      div.className = 'stamp'+(i<=used?' used':'');
      div.textContent = i<=used?'✔︎':'';
      div.dataset.index = i;
      div.onclick = toggleStamp;
      cardEl.appendChild(div);
    }
    cardEl.hidden = false;
  }

  function toggleStamp(e){
    const idx = +e.currentTarget.dataset.index;
    if(e.currentTarget.classList.toggle('used')){ e.currentTarget.textContent='✔︎'; used++; }
    else{ e.currentTarget.textContent=''; used--; }
    updateInfo();
    // 可加上 POST 更新到資料庫（略）
  }

  function updateInfo(service=''){
    remainingEl.textContent = `剩餘點數：${12-used}`;
    if(service) serviceEl.textContent = `服務：${service}`;
    document.getElementById('info').hidden = false;
  }
</script>
</body>
</html>